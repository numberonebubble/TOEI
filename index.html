<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Odd Earth Institute</title>
    <style>
        /* --- CORE STYLES --- */
        :root {
            --bg: #050a10;
            --blue: #4a90e2;
            --green: #00ff88;
            --gold: #ffcc00;
            --purple: #bf00ff;
            --alert: #ff3333;
            --dim: #445566;
            --panel: rgba(5, 10, 16, 0.95);
        }

        body, html {
            margin: 0;
            padding: 0;
            background-color: var(--bg);
            color: #eee;
            font-family: 'Courier New', Courier, monospace;
            width: 100%;
            height: 100%;
            overflow-x: hidden;
        }

        /* --- 3D CANVAS --- */
        #canvas-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            z-index: 1;
        }
        
        .scanlines {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                        linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 2px, 3px 100%;
            pointer-events: none;
            z-index: 2;
        }

        /* --- NAVIGATION --- */
        .nav-bar {
            position: fixed;
            top: 0; left: 0; width: 100%;
            padding: 25px;
            box-sizing: border-box;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            pointer-events: none;
        }
        
        .logo {
            font-size: 1.1rem;
            font-weight: bold;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 2px;
            pointer-events: auto;
            cursor: pointer;
            border-bottom: 2px solid var(--gold);
            padding-bottom: 5px;
        }

        .back-link {
            pointer-events: auto;
            cursor: pointer;
            color: var(--dim);
            text-transform: uppercase;
            font-size: 0.9rem;
            display: none; /* Hidden on home */
            transition: 0.3s;
            background: rgba(0,0,0,0.8);
            padding: 10px 20px;
            border: 1px solid var(--dim);
        }
        .back-link:hover { color: var(--gold); border-color: var(--gold); }

        /* --- SHARED LAYOUT --- */
        section {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            box-sizing: border-box;
        }

        .card {
            background: var(--panel);
            border: 1px solid var(--dim);
            padding: 3rem;
            max-width: 800px;
            width: 100%;
            box-shadow: 0 20px 50px rgba(0,0,0,0.8);
            position: relative;
            z-index: 10;
        }

        h1 { font-size: 2.5rem; margin: 0 0 1.5rem; color: #fff; text-transform: uppercase; line-height: 1.1; }
        h2 { font-size: 1.8rem; margin: 0 0 1rem; color: #fff; text-transform: uppercase; }
        p { font-size: 1.1rem; line-height: 1.8; color: #aaa; margin-bottom: 1.5rem; }
        .highlight { color: #fff; font-weight: bold; }
        
        .label {
            display: inline-block;
            font-size: 0.7rem;
            padding: 4px 8px;
            border: 1px solid rgba(255,255,255,0.2);
            margin-bottom: 20px;
            color: #888;
            letter-spacing: 2px;
            font-weight: bold;
            text-transform: uppercase;
        }

        /* --- HOME SPECIFIC --- */
        #view-home {
            position: relative;
            z-index: 10;
            width: 100%;
            transition: opacity 0.6s ease;
        }
        .card.hero { border-top: 4px solid var(--gold); text-align: center; }
        .card.conflict { border-left: 4px solid var(--alert); }
        .card.method { border-right: 4px solid var(--blue); text-align: right; }
        .card.mission { border-bottom: 4px solid var(--green); text-align: center; }

        .file-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            width: 100%;
            margin-top: 50px;
        }
        .file-item {
            background: rgba(255,255,255,0.03);
            border: 1px solid var(--dim);
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }
        .file-item:hover {
            border-color: var(--blue);
            background: rgba(74, 144, 226, 0.1);
            transform: translateY(-5px);
        }
        .file-number { font-size: 0.8rem; color: var(--dim); display: block; margin-bottom: 10px; }
        .file-title { font-size: 1.1rem; color: #fff; text-transform: uppercase; display: block; }

        /* --- PROBLEM VIEW SPECIFIC --- */
        #view-problem {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 20;
            display: none; 
            opacity: 0;
            transition: opacity 0.6s ease;
            overflow-y: auto;
            background: rgba(5,10,16,0.8);
        }
        
        .problem-wrapper {
            width: 100%;
        }

        /* The Scroll Layout for Problem View */
        .problem-section {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: flex-start; /* Left align problem */
            padding: 0 10%;
        }
        .solution-section {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: flex-end; /* Right align solution */
            padding: 0 10%;
        }

        .detail-card {
            background: var(--panel);
            border: 1px solid var(--dim);
            padding: 3rem;
            max-width: 500px;
        }

        .stat-row {
            display: flex;
            gap: 40px;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px dashed var(--dim);
        }
        .stat-block .val { display: block; font-size: 2rem; color: #fff; font-weight: bold; }
        .stat-block .lbl { display: block; font-size: 0.8rem; color: var(--dim); text-transform: uppercase; }

        @media (max-width: 768px) {
            h1 { font-size: 1.8rem; }
            .card, .detail-card { padding: 2rem; width: 100%; }
            .problem-section, .solution-section { padding: 80px 20px; justify-content: center; }
        }

    </style>
</head>
<body>

    <div class="nav-bar">
        <div class="logo" onclick="navigateTo('home')">THE ODD EARTH INSTITUTE</div>
        <div class="back-link" id="back-btn" onclick="navigateTo('home')">← RETURN TO ARCHIVE</div>
    </div>

    <div id="canvas-container"></div>
    <div class="scanlines"></div>

    <div id="view-home">
        <section>
            <div class="card hero">
                <span class="label">Identity</span>
                <h1>The Odd Earth Institute</h1>
                <p>We are a think tank for the left-behind.</p>
                <p>We use <span class="highlight">lateral thinking with withered technologies</span> to solve real-world problems for real people.</p>
                <br>
                <small style="color:var(--gold)">SCROLL TO DECLASSIFY</small>
            </div>
        </section>

        <section>
            <div class="card conflict">
                <span class="label">The Conflict</span>
                <h2>Profit & Policy Have Failed</h2>
                <p>Governments are paralyzed by bureaucracy. The Private Sector is paralyzed by greed.</p>
                <p>We operate with <span class="highlight" style="color:var(--alert)">no regard for either.</span> We are a force for good in a world that has forgotten how to build.</p>
            </div>
        </section>

        <section>
            <div class="card method">
                <span class="label">The Methodology</span>
                <h2>The Garage Approach</h2>
                <p>Inspired by <strong>Gunpei Yokoi</strong>. We don't need new physics. We need to look at old technology with new eyes.</p>
                <p>A calculator can become a game console. A microphone can become a medical scanner.</p>
            </div>
        </section>

        <section style="display: block; padding-top: 10vh;">
            <div class="card mission" style="margin: auto;">
                <span class="label">Access Case Files</span>
                <h2>Active Initiatives</h2>
                <p>Select a file to begin analysis.</p>
                <div class="file-grid">
                    <div class="file-item" onclick="openProblem(0)">
                        <span class="file-number">CASE 01</span>
                        <span class="file-title">The Medical Paradox</span>
                    </div>
                    <div class="file-item" onclick="openProblem(1)">
                        <span class="file-number">CASE 02</span>
                        <span class="file-title">Trauma Response</span>
                    </div>
                    <div class="file-item" onclick="openProblem(2)">
                        <span class="file-number">CASE 03</span>
                        <span class="file-title">Forensic Blindspots</span>
                    </div>
                    <div class="file-item" onclick="openProblem(3)">
                        <span class="file-number">CASE 04</span>
                        <span class="file-title">Precision Medicine</span>
                    </div>
                    <div class="file-item" onclick="openProblem(4)">
                        <span class="file-number">CASE 05</span>
                        <span class="file-title">Lateral Diagnostics</span>
                    </div>
                </div>
            </div>
            <br><br><br><br>
        </section>
    </div>

    <div id="view-problem">
        <div class="problem-wrapper">
            <div class="problem-section">
                <div class="detail-card" id="prob-card">
                    <span class="label">THE PROBLEM</span>
                    <h1 id="prob-title">Title</h1>
                    <p id="prob-content">Content</p>
                    <small>SCROLL FOR SOLUTION ▼</small>
                </div>
            </div>

            <div class="solution-section">
                <div class="detail-card" id="sol-card" style="border-right: 4px solid var(--green); text-align: right;">
                    <span class="label" style="color:var(--green); border-color:var(--green);">THE LATERAL SOLUTION</span>
                    <h2 id="sol-title" style="color:var(--green)">Title</h2>
                    <p id="sol-content">Content</p>
                    <div class="stat-row" id="sol-stats" style="justify-content: flex-end;"></div>
                    <br>
                    <button onclick="window.open('https://linkedin.com','_blank')" style="background:transparent; border:1px solid var(--gold); color:var(--gold); padding:10px 20px; cursor:pointer;">FUND THIS PROJECT</button>
                </div>
            </div>
        </div>
    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <script>
        // --- DATA ---
        const caseFiles = [
            {   // 0. MEDICAL
                color: 'blue',
                problem: {
                    title: "The Medical Paradox",
                    content: "It’s odd that we have CT scanners that can literally see inside our brains but we have a large population that live too far away to use them. Sure, let’s stick to big, expensive tubes that hardly anyone can afford.",
                    shape: 'scanner'
                },
                solution: {
                    title: "The Single Dot",
                    content: "We replaced the machine with a single thermochromatic dot on the forehead. It monitors vitals instantly using simple physics. No power. No waiting. Just a sticker.",
                    stats: `<div class="stat-block"><span class="val">99%</span><span class="lbl">Cheaper</span></div><div class="stat-block"><span class="val">100%</span><span class="lbl">Portable</span></div>`,
                    shape: 'dot'
                }
            },
            {   // 1. TRAUMA
                color: 'alert',
                problem: {
                    title: "First Responder Gap",
                    content: "The #1 cause of death for the working age is trauma. Our first responders are overworked and underequipped. Sure, let’s build a Garmin for Golf so you can track your swing.",
                    shape: 'watch'
                },
                solution: {
                    title: "Companion Plants",
                    content: "We use bio-modified plants in the home that change color based on the occupant's stress pheromones. Passive, constant monitoring without the battery life anxiety.",
                    stats: `<div class="stat-block"><span class="val">Zero</span><span class="lbl">Power</span></div><div class="stat-block"><span class="val">24/7</span><span class="lbl">Active</span></div>`,
                    shape: 'plant'
                }
            },
            {   // 2. FORENSICS
                color: 'green',
                problem: {
                    title: "Forensic Blindspots",
                    content: "Dogs can identify human targets with 90% accuracy, yet we stick to slow lab tests with an 8% conviction rate. We ignore the best sensor on earth.",
                    shape: 'gel'
                },
                solution: {
                    title: "K9 Olfactory Data",
                    content: "We utilize trained dogs to map scent data in real-time. We digitize their biological output into admissible forensic evidence. Nature's nose, digitized.",
                    stats: `<div class="stat-block"><span class="val">90%</span><span class="lbl">Accuracy</span></div><div class="stat-block"><span class="val">Real</span><span class="lbl">Time</span></div>`,
                    shape: 'dog'
                }
            },
            {   // 3. GENOMICS
                color: 'purple',
                problem: {
                    title: "The Precision Trap",
                    content: "We abandoned Feynman’s idea for using electron microscopes to physically look at DNA. We rely on expensive chemical sequencing that takes days.",
                    shape: 'helix'
                },
                solution: {
                    title: "Optical Crystals",
                    content: "We use basic salt crystallization. By observing how samples crystallize physically, we can screen for anomalies instantly for pennies. Physics over chemistry.",
                    stats: `<div class="stat-block"><span class="val">$50</span><span class="lbl">Cost</span></div><div class="stat-block"><span class="val">1hr</span><span class="lbl">Result</span></div>`,
                    shape: 'crystal'
                }
            },
            {   // 4. DIAGNOSTICS
                color: 'gold',
                problem: {
                    title: "Invasive Standards",
                    content: "We bleed into test tubes and call it “non-invasive”. We traumatize patients to get data we could get elsewhere.",
                    shape: 'tube'
                },
                solution: {
                    title: "Lateral Diagnostics",
                    content: "We utilize modified video game controllers to measure micro-tremors. We diagnose neuro-degenerative conditions while the patient plays a game.",
                    stats: `<div class="stat-block"><span class="val">0</span><span class="lbl">Needles</span></div><div class="stat-block"><span class="val">High</span><span class="lbl">Fun</span></div>`,
                    shape: 'controller'
                }
            }
        ];

        // --- 3D SETUP ---
        const PARTICLE_COUNT = 16000;
        const container = document.getElementById('canvas-container');
        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050a10);
        scene.fog = new THREE.Fog(0x050a10, 15, 60);

        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.z = 25;

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: false });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        container.appendChild(renderer.domElement);

        // --- SHAPES ---
        const rand = (min, max) => Math.random() * (max - min) + min;
        const createShapeData = () => ({ positions: [], colors: [] });
        const shapes = {
            globe: createShapeData(), barrier: createShapeData(), workshop: createShapeData(), network: createShapeData(),
            scanner: createShapeData(), dot: createShapeData(),
            watch: createShapeData(), plant: createShapeData(),
            gel: createShapeData(), dog: createShapeData(),
            helix: createShapeData(), crystal: createShapeData(),
            tube: createShapeData(), controller: createShapeData()
        };

        // Populate Shapes (Condensed for brevity)
        // Globe
        for(let i=0; i<PARTICLE_COUNT; i++) {
            const u=Math.random(), v=Math.random(), r=9, t=2*Math.PI*u, p=Math.acos(2*v-1);
            shapes.globe.positions.push(r*Math.sin(p)*Math.cos(t), r*Math.sin(p)*Math.sin(t), r*Math.cos(p));
            shapes.globe.colors.push(1, 0.8, 0); 
        }
        // Barrier
        for(let i=0; i<PARTICLE_COUNT; i++) {
            shapes.barrier.positions.push(rand(-15,15), rand(-10,10), rand(-1,1));
            shapes.barrier.colors.push(Math.random()>0.8 ? 1 : 0.3, Math.random()>0.8 ? 0.2 : 0.3, 0.4);
        }
        // Workshop
        for(let i=0; i<PARTICLE_COUNT; i++) {
             shapes.workshop.positions.push(rand(-8,8), rand(-5,5), rand(-5,5));
             shapes.workshop.colors.push(0, 1, 0.5);
        }
        // Network
        for(let i=0; i<PARTICLE_COUNT; i++) {
            const u=Math.random(), v=Math.random(), r=8, t=2*Math.PI*u, p=Math.acos(2*v-1);
            shapes.network.positions.push(r*Math.sin(p)*Math.cos(t), r*Math.sin(p)*Math.sin(t), r*Math.cos(p));
            shapes.network.colors.push(0, Math.random()>0.8?1:0.1, 0.5); 
        }
        // Scanner -> Dot
        for(let i=0; i<PARTICLE_COUNT; i++) {
            // Scanner
            if(i<PARTICLE_COUNT*0.7) {
                const a=rand(0,Math.PI*2), r=rand(9,11);
                shapes.scanner.positions.push(Math.cos(a)*r, Math.sin(a)*r, rand(-4,4)); shapes.scanner.colors.push(0.2, 0.6, 1);
            } else { shapes.scanner.positions.push(rand(-3,3), rand(-3,-2), rand(-10,10)); shapes.scanner.colors.push(1,1,1); }
            // Dot
            if(i<500) { shapes.dot.positions.push(rand(-0.5,0.5), 3+rand(-0.5,0.5), 4+rand(0,0.5)); shapes.dot.colors.push(1,0,0); } 
            else {
                const u=Math.random(), v=Math.random(), t=2*Math.PI*u, p=Math.acos(2*v-1);
                shapes.dot.positions.push(6*Math.sin(p)*Math.cos(t), 8*Math.sin(p)*Math.sin(t), (Math.cos(p)>0?4:2)*Math.cos(p));
                shapes.dot.colors.push(0.2, 0.8, 0.5);
            }
        }
        // Watch -> Plant
        for(let i=0; i<PARTICLE_COUNT; i++) {
            // Watch
            const r=Math.random();
            if(r<0.4) { const a=rand(0,Math.PI*2); if(Math.abs(a)>0.6) { shapes.watch.positions.push(Math.sin(a)*7, Math.cos(a)*7, rand(-2,2)); shapes.watch.colors.push(0.2,0.2,0.2); } else { shapes.watch.positions.push(0,0,0); shapes.watch.colors.push(0,0,0); } } 
            else { const x=rand(-3,3); let z=Math.abs(x)<1?Math.sin(x*10):0; shapes.watch.positions.push(x, 7, z); shapes.watch.colors.push(Math.abs(z)>0.1?1:0.1, 0, 0.2); }
            // Plant
            if(Math.random()>0.3) { const y=rand(-10,8), w=(10-y)*0.05; shapes.plant.positions.push(rand(-w,w), y, rand(-w,w)); shapes.plant.colors.push(0.4, 0.2, 0); } 
            else { const rr=rand(2,6), a=rand(0,Math.PI*2), y=rand(-5,8); shapes.plant.positions.push(Math.cos(a)*rr, y, Math.sin(a)*rr); shapes.plant.colors.push(0, 1, 0.2); }
        }
        // Gel -> Dog
        for(let i=0; i<PARTICLE_COUNT; i++) {
            const y=rand(-10,10);
            shapes.gel.positions.push(rand(-6,6), y, rand(-0.5,0.5)); shapes.gel.colors.push(0, (y%4>2)?1:0.2, (y%4>2)?1:0.4);
            const rr=Math.random(); let x,yy,z,c=[0.6,0.4,0.2];
            if(rr<0.5) { x=rand(-4,4); yy=rand(-2,2); z=rand(-1.5,1.5); } else if(rr<0.7) { x=rand(4,6); yy=rand(1,3.5); z=rand(-1,1); } else if(rr<0.9) { x=(rand(-1,1)>0?3:-3); yy=rand(-6,-2); z=rand(-1,1); } else { x=rand(-6,-4); yy=rand(0,2); z=0; }
            shapes.dog.positions.push(x,yy,z); shapes.dog.colors.push(...c);
        }
        // Helix -> Crystal
        for(let i=0; i<PARTICLE_COUNT; i++) {
            const t=rand(-10,10); if(Math.random()>0.3) { const s=Math.random()>0.5?0:Math.PI; shapes.helix.positions.push(Math.cos(t*1.5+s)*5, t*1.5, Math.sin(t*1.5+s)*5); shapes.helix.colors.push(0.6,0,0.8); } else { shapes.helix.positions.push(Math.cos(t*1.5)*rand(-5,5), t*1.5, Math.sin(t*1.5)*rand(-5,5)); shapes.helix.colors.push(0,0.8,0.8); }
            const cl=Math.floor(Math.random()*3), cx=(cl==1)?4:(cl==2)?-4:0, cy=(cl==0)?-4:0, s=rand(0,3); shapes.crystal.positions.push(cx+rand(-s,s), cy+rand(0,s*2), rand(-s,s)); shapes.crystal.colors.push(0,1,1);
        }
        // Tube -> Controller
        for(let i=0; i<PARTICLE_COUNT; i++) {
            if(i<PARTICLE_COUNT*0.8) { const a=rand(0,Math.PI*2), h=rand(-5,5); shapes.tube.positions.push(Math.cos(a)*2, h, Math.sin(a)*2); shapes.tube.colors.push(0.8,0.8,1); } else { shapes.tube.positions.push(rand(-1.8,1.8), rand(-4,0), rand(-1.8,1.8)); shapes.tube.colors.push(1,0,0); }
            const r=Math.random(); if(r<0.4) shapes.controller.positions.push(rand(-7,-3), rand(-2,2), rand(-2,2)); else if(r<0.8) shapes.controller.positions.push(rand(3,7), rand(-2,2), rand(-2,2)); else shapes.controller.positions.push(rand(-3,3), rand(-1,1), rand(-1,1)); shapes.controller.colors.push(1,0.8,0);
        }

        // --- INIT MESH ---
        const geometry = new THREE.BufferGeometry();
        const posArr = new Float32Array(PARTICLE_COUNT*3);
        const colArr = new Float32Array(PARTICLE_COUNT*3);
        for(let i=0; i<PARTICLE_COUNT*3; i++) { posArr[i]=shapes.globe.positions[i]; colArr[i]=shapes.globe.colors[i]; }
        geometry.setAttribute('position', new THREE.BufferAttribute(posArr, 3));
        geometry.setAttribute('color', new THREE.BufferAttribute(colArr, 3));
        const material = new THREE.PointsMaterial({ size: 0.15, vertexColors: true, transparent: true, opacity: 0.9, blending: THREE.AdditiveBlending });
        const points = new THREE.Points(geometry, material);
        scene.add(points);

        // --- STATE & NAVIGATION ---
        let state = 'home';
        let currentPosTarget = shapes.globe.positions;
        let currentColTarget = shapes.globe.colors;
        let activeCaseIndex = -1;

        const homeView = document.getElementById('view-home');
        const problemView = document.getElementById('view-problem');
        const backBtn = document.getElementById('back-btn');

        // HOME SCROLL
        window.addEventListener('scroll', () => {
            if(state !== 'home') return;
            const idx = Math.round(window.scrollY / window.innerHeight);
            let target = 'globe';
            if(idx === 1) target = 'barrier';
            if(idx === 2) target = 'workshop';
            if(idx >= 3) target = 'network';
            currentPosTarget = shapes[target].positions;
            currentColTarget = shapes[target].colors;
        });

        // PROBLEM SCROLL
        problemView.addEventListener('scroll', () => {
            if(state !== 'problem') return;
            const scroll = problemView.scrollTop;
            const h = window.innerHeight;
            const data = caseFiles[activeCaseIndex];
            
            // If scrolled past half viewport, morph to solution
            if(scroll > h * 0.5) {
                currentPosTarget = shapes[data.solution.shape].positions;
                currentColTarget = shapes[data.solution.shape].colors;
            } else {
                currentPosTarget = shapes[data.problem.shape].positions;
                currentColTarget = shapes[data.problem.shape].colors;
            }
        });

        window.openProblem = function(index) {
            state = 'problem';
            activeCaseIndex = index;
            const data = caseFiles[index];

            // Populate Content
            document.getElementById('prob-card').style.borderLeftColor = `var(--${data.color})`;
            document.getElementById('prob-title').innerText = data.problem.title;
            document.getElementById('prob-content').innerText = data.problem.content;
            
            document.getElementById('sol-title').innerText = data.solution.title;
            document.getElementById('sol-content').innerText = data.solution.content;
            document.getElementById('sol-stats').innerHTML = data.solution.stats;

            // Transition
            homeView.style.opacity = 0;
            setTimeout(() => {
                homeView.style.display = 'none';
                problemView.style.display = 'block';
                backBtn.style.display = 'block';
                setTimeout(() => problemView.style.opacity = 1, 50);
                
                // Initial Shape
                currentPosTarget = shapes[data.problem.shape].positions;
                currentColTarget = shapes[data.problem.shape].colors;
            }, 500);
        };

        window.navigateTo = function(dest) {
            if(dest === 'home') {
                state = 'home';
                problemView.style.opacity = 0;
                backBtn.style.display = 'none';
                setTimeout(() => {
                    problemView.style.display = 'none';
                    // Reset scroll on problem view so it starts at top next time
                    problemView.scrollTop = 0; 
                    homeView.style.display = 'block';
                    setTimeout(() => homeView.style.opacity = 1, 50);
                }, 500);
                currentPosTarget = shapes.globe.positions;
                currentColTarget = shapes.globe.colors;
            }
        };

        // --- ANIMATION ---
        const clock = new THREE.Clock();
        function animate() {
            requestAnimationFrame(animate);
            const time = clock.getElapsedTime();
            const p = geometry.attributes.position.array;
            const c = geometry.attributes.color.array;
            const speed = 0.05;

            // Offset Logic
            // Home: Center
            // Problem (Top): Left (Text is Left) -> Shape Right
            // Solution (Bottom): Right (Text is Right) -> Shape Left
            let xOffset = 0;
            if (state === 'problem') {
                const scroll = problemView.scrollTop;
                const h = window.innerHeight;
                // Lerp offset based on scroll position
                // 0 scroll = +7 (Right side of screen)
                // Full scroll = -7 (Left side of screen)
                const progress = Math.min(Math.max(scroll / h, 0), 1);
                xOffset = 7 - (progress * 14); 
            }

            for(let i=0; i<PARTICLE_COUNT; i++) {
                const ix=i*3, iy=i*3+1, iz=i*3+2;
                p[ix] += (currentPosTarget[ix] + xOffset - p[ix]) * speed;
                p[iy] += (currentPosTarget[iy] - p[iy]) * speed;
                p[iz] += (currentPosTarget[iz] - p[iz]) * speed;
                c[ix] += (currentColTarget[ix] - c[ix]) * speed;
                c[iy] += (currentColTarget[iy] - c[iy]) * speed;
                c[iz] += (currentColTarget[iz] - c[iz]) * speed;
                p[ix] += Math.sin(time+p[iy])*0.003; 
            }
            geometry.attributes.position.needsUpdate = true;
            geometry.attributes.color.needsUpdate = true;
            
            if(state==='home') points.rotation.y += 0.001;
            else points.rotation.y = Math.sin(time*0.2)*0.1;

            renderer.render(scene, camera);
        }
        animate();
        window.addEventListener('resize', ()=>{
            camera.aspect=window.innerWidth/window.innerHeight; camera.updateProjectionMatrix(); renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>
